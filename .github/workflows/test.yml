name: build

on: [push, pull_request]

jobs:
  build:

    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false

      matrix:
        python-version: [3.6, 3.7, 3.8, "3.9.0-rc.1"]
#        python-version: [3.6, 3.7, 3.8, "3.9.0-rc.1"]
        qt-lib: [pyqt5, pyside2]
        qtversion: [14, 15]
        os: [ubuntu-latest, windows-latest, macos-latest]
        include:
          - python-version: "3.6"
            tox-env: "py36"
          - python-version: "3.7"
            tox-env: "py37"
          - python-version: "3.8"
            tox-env: "py38"
#          - python-version: "3.9.0-rc.1"
#            tox-env: "py39"

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install tox
    - name: Test with tox
      run: |
        tox -e ${{ matrix.tox-env }}-${{ matrix.qt-lib }}${{ matrix.qtversion }} -- -ra --color=yes
#        if: ${{ format('{{{0}-{1}{2} }}', matrix.tox-env, matrix.qt-lib, matrix.qtversion) != 'py39-pyside214' }}
#
#  deploy:
#
#    runs-on: ubuntu-latest
#
#    needs: [build, checks]
#
#    steps:
#    - uses: actions/checkout@v1
#    - name: Set up Python
#      uses: actions/setup-python@v1
#      with:
#        python-version: "3.7"
#    - name: Build package
#      run: |
#        python -m pip install --upgrade pip setuptools
#        pip install wheel
#        python setup.py sdist bdist_wheel
#    - name: Publish package to PyPI
#      if: github.event_name == 'push' && startsWith(github.event.ref, 'refs/tags')
#      uses: pypa/gh-action-pypi-publish@master
#      with:
#        user: __token__
#        password: ${{ secrets.pypi_token }}